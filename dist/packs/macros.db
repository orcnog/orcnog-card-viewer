{"name":"View a Card","type":"script","author":"orcnog","img":"modules/orcnog-card-viewer/assets/card-view-fancy.svg","scope":"global","command":"// Requires Orcnog's Card Viewer\n// Peeks at a card, but does not draw and discard it.\n\nlet deckName = 'Deck of Many Things';\nlet card = 'Gem'; // card name or ID\nlet faceDown = true;\nlet whisper = false;\nlet share = false;\n\nOrcnogFancyCardDealer({\n   deckName: deckName,\n}).view(card, faceDown, whisper, share);","flags":{"core":{"sourceId":"Macro.dq0cclm7r5tOc4pL"},"exportSource":{"world":"v11-test","system":"worldbuilding","coreVersion":"11.305","systemVersion":"0.8.1"}},"_stats":{"systemId":"swade","systemVersion":"2.4.2","coreVersion":"10.303","createdTime":1686860654456,"modifiedTime":1688760983048,"lastModifiedBy":"92aKSz8wx6tVXpQm"},"folder":null,"sort":0,"ownership":{"default":0,"92aKSz8wx6tVXpQm":3},"_id":"PSnKE22o6C86rSvS"}
{"name":"Draw and Show Card in Regular Popout","type":"script","author":"orcnog","img":"modules/orcnog-card-viewer/assets/card-draw.svg","scope":"global","command":"// Does not actually require Orcnog's Card Viewer!\n// A helper macro to automate drawing a random card and viewing it in a native Image Popout.\n// Updated for v12.\n\nlet dealFrom_stackName = \"Deck of Many Things\"\nlet dealTo_stackName = \"My Discard Pile\"\nlet drawMethod = \"RANDOM\" // either \"RANDOM\" or \"TOP\"\nlet showToAll = true\n\n// Get reference to src/dst cards objects\nconst src_cards = game.cards.getName(dealFrom_stackName)\nconst dst_cards = game.cards.getName(dealTo_stackName) || await Cards.create({ name: dealFrom_stackName + \" - Discard Pile\", type: \"pile\" })\nconsole.log('dst_cards', dst_cards)\n\n// Deal 1 card and grab reference to the dealt card\nlet isLikelySuccess = true\nlet drawnCardsArr; // Variable to store the drawn card if module is not active\n\ntry {\n  drawnCardsArr = await dst_cards.draw(src_cards, 1, {\n    how: CONST.CARD_DRAW_MODES[drawMethod],\n    action: getActionString()\n  })\n} catch (e) {\n  console.error('error drawing card:', e)\n  // Foundry doesn't like \"draw ocv_nohook\". Anything more than \"draw\" makes the Promise throw an error... yet it still draws the card before throwing the error... so, for our purposes, it worked!\n  // If it throws this known error, assume it actually succeeded.  Otherwise notify user of the error.\n  if (e && e.message\n        && !e.message.toLowerCase().includes('replace') // Chrom/Safari/Electron error msg\n        && !e.message.toLowerCase().includes('str is undefined') // Firefox error msg\n    ){\n    ui.notifications.warn(e.message)\n    isLikelySuccess = false\n  }\n}\nif (isLikelySuccess) {\n  let most_recent_drawn;\n  if (isModuleActive()) {\n    most_recent_drawn = dst_cards.cards.contents[dst_cards.cards.size - 1]\n  } else {\n    most_recent_drawn = drawnCardsArr?.[0]; // Use the drawnCard variable if module is not active\n  }\n  console.log('Drawn Card:', most_recent_drawn)\n  const cardId = most_recent_drawn?._id\n  const name = most_recent_drawn?.faces?.[0]?.name\n  const front = most_recent_drawn?.faces?.[0]?.img\n  const back = most_recent_drawn?.back?.img\n  const desc = most_recent_drawn?.faces?.[0]?.text\n\n  // Show it as an Image Popout...\n  const ip = new ImagePopout(front, {})\n  if (ip.render(true)) {\n    if (showToAll) {\n      // Share the image with other connected players\n      ip.shareImage()\n    }\n  }\n\n  // Whisper the card instructions to the DM\n  const dm = game.users.find(u => u.isGM && u.active)\n  if (dm) {\n    const messageContent = `<p>Card(s) drawn:</p>\n      <div class=\"card-draw orcnog-card-viewer-msg flexrow\" data-deck=\"${dealFrom_stackName}\" data-card=\"${cardId}\" data-back=\"${back}\">\n        <img class=\"card-face\" src=\"${front}\" alt=\"${name}\"/>\n        <h4 class=\"card-name\">${name}</h4>\n      </div>\n      <p>${desc}</p>`\n    ChatMessage.create({ content: messageContent, whisper: [dm._id] })\n  } else {\n    ui.notifications.warn(\"DM user not found.\")\n  }\n}\n\nfunction isModuleActive() {\n  return game.modules.get(\"orcnog-card-viewer\")?.active\n}\n\nfunction getActionString() {\n  return isModuleActive() ? 'draw ocv_nohook' : 'draw'\n}","_id":"eprTdFmz2BQxTgSx","_key":"!macros!eprTdFmz2BQxTgSx"}
{"name":"Draw a Card","type":"script","author":"orcnog","img":"modules/orcnog-card-viewer/assets/card-draw-fancy.svg","scope":"global","command":"// Requires Orcnog's Card Viewer\n// Draws, views, and discards a card from a given deck name. Leave discardPile null to smart-match an existing discard pile name or auto-create a new one named \"[your deck name] - Discard Pile\".\n\nlet deckName = 'Deck of Many Things';\nlet discardPile = 'My Discard Pile';\nlet share = true;\n\nOrcnogFancyCardDealer({\n   deckName: deckName ,\n   discardPileName: discardPile\n}).draw({share:share});","flags":{"core":{"sourceId":"Macro.UsTgJD5uFf9tOGYO"},"exportSource":{"world":"v11-test","system":"worldbuilding","coreVersion":"11.305","systemVersion":"0.8.1"}},"_stats":{"systemId":"swade","systemVersion":"2.4.2","coreVersion":"10.303","createdTime":1686860654456,"modifiedTime":1688760985877,"lastModifiedBy":"92aKSz8wx6tVXpQm"},"folder":null,"sort":0,"ownership":{"default":0,"92aKSz8wx6tVXpQm":3},"_id":"XCvcqGgOsDhwXDR9"}
{"name":"View Any Image as a Card","type":"script","author":"orcnog","img":"modules/orcnog-card-viewer/assets/image-view-fancy.svg","scope":"global","command":"// Requires Orcnog's Card Viewer\n// This macro demonstrates the easiest way to view any image (URL or local path) as a flippable card. The card back image is automatically provided.\n\nlet img = 'modules/orcnog-card-viewer/assets/beefy-abraham-lincoln.webp';\nlet backImg = 'https://i.imgur.com/mStOCso.png'; // optional\nlet borderColor = '#543'; // optional\nlet borderWidth = '5px'; // optional\nlet shareToAll = true; // optional\n\nOrcnogFancyDisplay({\n   front: img,\n   back: backImg,\n   border: borderColor,\n   borderWidth: borderWidth\n}).render(shareToAll)","flags":{"core":{"sourceId":"Macro.W2KFsMfjHy8uC9AY"},"exportSource":{"world":"v11-test","system":"worldbuilding","coreVersion":"11.305","systemVersion":"0.8.1"}},"_stats":{"systemId":"swade","systemVersion":"2.4.2","coreVersion":"10.303","createdTime":1686762627106,"modifiedTime":1688760981671,"lastModifiedBy":"92aKSz8wx6tVXpQm"},"folder":null,"sort":0,"ownership":{"default":0,"92aKSz8wx6tVXpQm":3},"_id":"uRc3ORD74VGZBLcS"}
